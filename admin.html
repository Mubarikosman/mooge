<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel | Moge Campaign</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/feather-icons"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&display=swap" rel="stylesheet">
<style>
body { font-family: 'Manrope', sans-serif; background-color: #f1f5f9; }
.sidebar { transition: transform 0.3s ease-in-out; }
.content { transition: margin-left 0.3s ease-in-out; }
.stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: #f1f5f9; }
::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
::-webkit-scrollbar-thumb:hover { background: #64748b; }
</style>
</head>
<body>
<div id="login-modal" class="fixed inset-0 bg-slate-900 z-50 flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-md p-8 rounded-2xl shadow-2xl text-center">
        <h2 class="text-3xl font-bold text-slate-800 mb-2">Admin Panel Login</h2>
        <p class="text-slate-500 mb-8">Enter your credentials to continue</p>
        <div class="space-y-4">
            <input id="login-id" type="text" placeholder="ID (e.g., 20202030)" class="w-full p-4 text-center rounded-lg bg-slate-100 border-2 border-transparent focus:outline-none focus:border-sky-500 transition">
            <input id="login-password" type="password" placeholder="Password" class="w-full p-4 text-center rounded-lg bg-slate-100 border-2 border-transparent focus:outline-none focus:border-sky-500 transition">
            <input id="login-secret" type="password" placeholder="Secret Phrase" class="w-full p-4 text-center rounded-lg bg-slate-100 border-2 border-transparent focus:outline-none focus:border-sky-500 transition">
            <button id="login-btn" class="w-full bg-sky-600 text-white font-bold p-4 rounded-lg hover:bg-sky-700 transition-colors shadow-lg">Login</button>
        </div>
        <p id="login-error" class="text-red-500 mt-4 font-semibold hidden">Invalid credentials. Please try again.</p>
    </div>
</div>
<div id="admin-panel" class="hidden">
    <aside class="sidebar bg-slate-800 text-slate-100 w-64 fixed h-full p-4 flex flex-col">
        <div class="text-2xl font-bold text-white mb-10 text-center">Moge Admin</div>
        <nav class="flex-grow">
            <a href="#" data-view="dashboard" class="nav-link bg-slate-700 flex items-center p-3 rounded-lg mb-2"><i data-feather="home" class="mr-3"></i>Dashboard</a>
            <a href="#" data-view="voters" class="nav-link hover:bg-slate-700 flex items-center p-3 rounded-lg mb-2"><i data-feather="users" class="mr-3"></i>Voters List</a>
            <a href="#" data-view="messages" class="nav-link hover:bg-slate-700 flex items-center p-3 rounded-lg mb-2 relative">
                <i data-feather="message-square" class="mr-3"></i>Messages
                <span id="unread-messages-badge" class="absolute top-2 right-2 bg-red-500 text-white text-xs w-5 h-5 flex items-center justify-center rounded-full hidden">0</span>
            </a>
        </nav>
        <button id="logout-btn" class="mt-auto hover:bg-slate-700 flex items-center p-3 rounded-lg w-full"><i data-feather="log-out" class="mr-3"></i>Logout</button>
    </aside>
    <main id="content" class="content ml-64 p-8">
        <h1 id="view-title" class="text-4xl font-bold text-slate-800 mb-8">Dashboard</h1>
        <div id="view-content"></div>
    </main>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {
    feather.replace();

    const loginModal = document.getElementById('login-modal');
    const adminPanel = document.getElementById('admin-panel');
    const loginBtn = document.getElementById('login-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const navLinks = document.querySelectorAll('.nav-link');
    const viewTitle = document.getElementById('view-title');
    const viewContent = document.getElementById('view-content');

    const ADMIN_ID = "20202030";
    const ADMIN_PASS = "mooge admin 2030";
    const ADMIN_SECRET = "ma ogi";

    loginBtn.addEventListener('click', () => {
        const id = document.getElementById('login-id').value;
        const pass = document.getElementById('login-password').value;
        const secret = document.getElementById('login-secret').value;
        if(id === ADMIN_ID && pass === ADMIN_PASS && secret === ADMIN_SECRET) {
            loginModal.classList.add('hidden');
            adminPanel.classList.remove('hidden');
            initializeApp();
        } else {
            document.getElementById('login-error').classList.remove('hidden');
        }
    });

    logoutBtn.addEventListener('click', () => location.reload());

    function initializeApp() {
        const firebaseConfig = {
            apiKey: "AIzaSyAnsvGANXpSJVq6B2Yd4woI4caflDvzrYI",
            authDomain: "maayor-mooge.firebaseapp.com",
            projectId: "maayor-mooge",
            storageBucket: "maayor-mooge.appspot.com",
            messagingSenderId: "771226998257",
            appId: "1:771226998257:web:d8029353f27111f143e050"
        };
        if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Listen for real-time updates
        db.collection('votes').orderBy('votedAt', 'desc').onSnapshot(snapshot => {
            const votes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderVoters(votes);
            renderDashboard(votes);
        });
        db.collection('messages').orderBy('sentAt', 'desc').onSnapshot(snapshot => {
            const messages = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderMessages(messages);
            updateUnreadBadge(messages);
        });

        navLinks.forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                const view = link.dataset.view;
                renderView(view);
                navLinks.forEach(l => l.classList.remove('bg-slate-700'));
                link.classList.add('bg-slate-700');
            });
        });

        function renderView(view) {
            viewTitle.textContent = view.charAt(0).toUpperCase() + view.slice(1);
            switch(view) {
                case 'dashboard': renderDashboard(); break;
                case 'voters': renderVoters(); break;
                case 'messages': renderMessages(); break;
            }
            feather.replace();
        }

        function updateUnreadBadge(messages) {
            const unreadCount = messages.filter(m => !m.isRead).length;
            const badge = document.getElementById('unread-messages-badge');
            if(unreadCount > 0){ badge.textContent = unreadCount; badge.classList.remove('hidden'); }
            else badge.classList.add('hidden');
        }

        function renderDashboard(votes = []) {
            const uniqueCities = [...new Set(votes.map(v=>v.geo_city).filter(Boolean))].length;
            const uniqueCountries = [...new Set(votes.map(v=>v.geo_country_name).filter(Boolean))].length;
            viewContent.innerHTML = `<div class='text-slate-500 p-6'>Dashboard will display charts here. Total Votes: ${votes.length}, Cities: ${uniqueCities}, Countries: ${uniqueCountries}</div>`;
        }

        function renderVoters(votes = []) {
            viewContent.innerHTML = `<div class='bg-white p-6 rounded-xl shadow-md overflow-x-auto'><table class='w-full'><thead><tr><th class='p-3'>Name</th><th class='p-3'>City</th><th class='p-3'>Country</th></tr></thead><tbody>${votes.map(v=>`<tr class='border-t'><td class='p-3'>${v.name}</td><td class='p-3'>${v.geo_city || 'N/A'}</td><td class='p-3'>${v.geo_country_name || 'N/A'}</td></tr>`).join('')}</tbody></table></div>`;
        }

        function renderMessages(messages = []) {
            if(messages.length === 0){ viewContent.innerHTML = `<p class='text-center text-slate-500 p-8'>No messages</p>`; return; }
            viewContent.innerHTML = messages.map(msg => `<div class='bg-white p-4 rounded-xl shadow-md mb-2 border-l-4 ${msg.isRead?'border-transparent':'border-sky-500'}'><p class='font-bold'>${msg.name} (${msg.contact})</p><p>${msg.message}</p></div>`).join('');
        }
    }
});
</script>
</body>
</html>
